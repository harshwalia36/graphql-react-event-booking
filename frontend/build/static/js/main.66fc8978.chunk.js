(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{22:function(e,t,n){e.exports=n(43)},27:function(e,t,n){},28:function(e,t,n){},29:function(e,t,n){},30:function(e,t,n){},31:function(e,t,n){},32:function(e,t,n){},33:function(e,t,n){},34:function(e,t,n){},35:function(e,t,n){},36:function(e,t,n){},42:function(e,t,n){},43:function(e,t,n){"use strict";n.r(t);var a=n(0),o=n.n(a),i=n(18),r=n.n(i),l=(n(27),n(5)),c=n(6),s=n(8),u=n(7),m=n(11),d=n(9),h=o.a.createContext({token:null,userId:null,login:function(e,t,n){},logout:function(){}}),f=(n(28),function(e){Object(s.a)(n,e);var t=Object(u.a)(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,e)).state={isLogin:!0},a.switchModeHandler=function(){a.setState((function(e){return{isLogin:!e.isLogin}}))},a.submitHandler=function(e){e.preventDefault();var t=a.emailElem.current.value,n=a.passwordElem.current.value;if(0!==t.trim().length&&0!==n.trim().length){var o={query:'\n              query {\n                  login (email:"'.concat(t,'",password:"').concat(n,'") {\n                      userId\n                      token\n                      tokenExpiration\n                  }\n              }\n              ')};a.state.isLogin||(o={query:'\n                mutation {\n                    createUser(userinput:{email:"'.concat(t,'",password:"').concat(n,'"}){\n                        _id\n                        email\n                    }\n                }')}),fetch("http://localhost:8000/graphql",{method:"POST",body:JSON.stringify(o),headers:{"Content-Type":"application/json"}}).then((function(e){if(200!==e.status&&201!==e.status)throw new Error("Failed");return e.json()})).then((function(e){e.data.login.token&&a.context.login(e.data.login.token,e.data.login.userId,e.data.login.tokenExpiration)})).catch((function(e){console.log(e)}))}},a.emailElem=o.a.createRef(),a.passwordElem=o.a.createRef(),a}return Object(c.a)(n,[{key:"render",value:function(){return o.a.createElement(o.a.Fragment,null,o.a.createElement("h1",{className:"headingAuth"},this.state.isLogin?"Login Page":"SignUp page"),o.a.createElement("form",{className:"auth-form",onSubmit:this.submitHandler},o.a.createElement("div",{className:"form-control"},o.a.createElement("label",{htmlFor:"email"},"Email"),o.a.createElement("input",{type:"email",id:"email",ref:this.emailElem})),o.a.createElement("div",{className:"form-control"},o.a.createElement("label",{htmlFor:"password"},"Password"),o.a.createElement("input",{type:"password",id:"password",ref:this.passwordElem})),o.a.createElement("div",{className:"form-action"},o.a.createElement("button",{className:"btn",type:"submit"},"Submit"),o.a.createElement("button",{className:"btn",type:"button",onClick:this.switchModeHandler},"Switch to ",this.state.isLogin?"SignUp":"Login"))))}}]),n}(a.Component));f.contextType=h;var E=f,v=(n(29),function(){return o.a.createElement("div",{className:"spinner"},o.a.createElement("div",{className:"lds-dual-ring"}))}),p=(n(30),function(e){return o.a.createElement("ul",{className:"bookings__list"},e.bookings.map((function(t){return o.a.createElement("li",{key:t._id,className:"bookings__item"},o.a.createElement("div",{className:"bookings__item-data"},t.event.title," -"," ",new Date(t.createdAt).toLocaleDateString()),o.a.createElement("div",{className:"bookings__item-actions"},o.a.createElement("button",{className:"btn",onClick:e.onDelete.bind(void 0,t._id)},"Cancel")))})))}),g=function(e){Object(s.a)(n,e);var t=Object(u.a)(n);function n(){var e;Object(l.a)(this,n);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return(e=t.call.apply(t,[this].concat(o))).state={isLoading:!1,bookings:[]},e.fetchBookings=function(){e.setState({isLoading:!0});var t=e.context.token;fetch("http://localhost:8000/graphql",{method:"POST",body:JSON.stringify({query:"\n          query {\n            bookings {\n              _id\n              createdAt\n              event {\n                _id\n                title\n                date\n              }\n            }\n          }\n        "}),headers:{"Content-Type":"application/json",Authorization:"Bearer "+t}}).then((function(e){if(200!==e.status&&201!==e.status)throw new Error("Failed");return e.json()})).then((function(t){var n=t.data.bookings;e.setState({bookings:n,isLoading:!1})})).catch((function(t){console.log(t),e.setState({isLoading:!1})}))},e.deleteBookingHandler=function(t){e.setState({isLoading:!0});var n={query:'\n                mutation {\n                    cancelBooking(bookingId:"'.concat(t,'") {\n                    _id\n                    title\n                  }\n                }\n              ')},a=e.context.token;fetch("http://localhost:8000/graphql",{method:"POST",body:JSON.stringify(n),headers:{"Content-Type":"application/json",Authorization:"Bearer "+a}}).then((function(e){if(200!==e.status&&201!==e.status)throw new Error("Failed");return e.json()})).then((function(n){e.setState((function(e){return{bookings:e.bookings.filter((function(e){return e._id!==t})),isLoading:!1}}))})).catch((function(t){console.log(t),e.setState({isLoading:!1})}))},e}return Object(c.a)(n,[{key:"componentDidMount",value:function(){this.fetchBookings()}},{key:"render",value:function(){return o.a.createElement(o.a.Fragment,null,this.state.isLoading?o.a.createElement(v,null):o.a.createElement(p,{bookings:this.state.bookings,onDelete:this.deleteBookingHandler}))}}]),n}(a.Component);g.contextType=h;var b=g,k=n(21),y=(n(31),function(e){return o.a.createElement("div",{className:"modal"},o.a.createElement("header",{className:"modal__header"},o.a.createElement("h1",null,e.title)),o.a.createElement("section",{className:"modal__content"},e.children),o.a.createElement("section",{className:"modal__actions"},e.canCancel&&o.a.createElement("button",{className:"btn",onClick:e.onCancel},"Cancel"),e.canConfirm&&o.a.createElement("button",{className:"btn",onClick:e.onConfirm},e.confirmText)))}),C=(n(32),function(e){return o.a.createElement("div",{className:"backdrop"})}),N=(n(33),n(34),function(e){return o.a.createElement("li",{key:e.eventId,className:"events_list-item"},o.a.createElement("div",null,o.a.createElement("h1",null,e.title),o.a.createElement("h2",null,"$",e.price," -- ",new Date(e.date).toLocaleDateString())),o.a.createElement("div",null,e.userId===e.creatorId?o.a.createElement("p",null,"Your the owner of this event."):o.a.createElement("button",{className:"btn",onClick:e.onDetail.bind(void 0,e.eventId)},"View Details")))}),S=(n(35),function(e){var t=e.events.map((function(t){return o.a.createElement(N,{key:t._id,eventId:t._id,title:t.title,price:t.price,date:t.date,userId:e.authUserId,creatorId:t.creator._id,onDetail:e.onViewDetail})}));return o.a.createElement("ul",{className:"event_list"},t)}),w=function(e){Object(s.a)(n,e);var t=Object(u.a)(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,e)).state={creating:!1,events:[],isLoading:!1,selectedEvent:null},a.isActive=!0,a.startCreateEventHandler=function(){a.setState({creating:!0})},a.modalConfirmHandler=function(){a.setState({creating:!1});var e=a.titleElRef.current.value,t=+a.priceElRef.current.value,n=a.dateElRef.current.value,o=a.descriptionElRef.current.value;if(!(0===e.trim().length||t<=0||0===n.trim().length||0===o.trim().length)){var i={title:e,price:t,date:n,description:o};console.log(i);var r={query:'\n          mutation {\n            createEvent(eventinput: {title: "'.concat(e,'", description: "').concat(o,'", price: ').concat(t,', date: "').concat(n,'"}) {\n              _id\n              title\n              description\n              date\n              price\n            }\n          }\n        ')},l=a.context.token;fetch("http://localhost:8000/graphql",{method:"POST",body:JSON.stringify(r),headers:{"Content-Type":"application/json",Authorization:"Bearer "+l}}).then((function(e){if(200!==e.status&&201!==e.status)throw new Error("Failed");return e.json()})).then((function(e){a.setState((function(t){var n=Object(k.a)(t.events);return n.push({_id:e.data.createEvent._id,title:e.data.createEvent.title,description:e.data.createEvent.description,date:e.data.createEvent.date,price:e.data.createEvent.price,creator:{_id:a.context.userId}}),{events:n}}))})).catch((function(e){console.log(e)}))}},a.modalCancelHandler=function(){a.setState({creating:!1,selectedEvent:null})},a.showDetailHandler=function(e){a.setState((function(t){return{selectedEvent:t.events.find((function(t){return t._id===e}))}}))},a.bookEventHandler=function(){if(a.context.token){var e={query:'\n          mutation {\n            bookEvent(eventId: "'.concat(a.state.selectedEvent._id,'") {\n              _id\n             createdAt\n             updatedAt\n            }\n          }\n        ')};fetch("http://localhost:8000/graphql",{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json",Authorization:"Bearer "+a.context.token}}).then((function(e){if(200!==e.status&&201!==e.status)throw new Error("Failed!");return e.json()})).then((function(e){console.log(e),a.setState({selectedEvent:null})})).catch((function(e){console.log(e)}))}else a.setState({selectedEvent:null})},a.titleElRef=o.a.createRef(),a.priceElRef=o.a.createRef(),a.dateElRef=o.a.createRef(),a.descriptionElRef=o.a.createRef(),a}return Object(c.a)(n,[{key:"componentDidMount",value:function(){this.fetchEvents()}},{key:"fetchEvents",value:function(){var e=this;this.setState({isLoading:!0});fetch("http://localhost:8000/graphql",{method:"POST",body:JSON.stringify({query:"\n          query {\n            events {\n              _id\n              title\n              description\n              date\n              price\n              creator {\n                _id\n                email\n              }\n            }\n          }\n        "}),headers:{"Content-Type":"application/json"}}).then((function(e){if(200!==e.status&&201!==e.status)throw new Error("Failed");return e.json()})).then((function(t){var n=t.data.events;e.isActive&&e.setState({events:n,isLoading:!1})})).catch((function(t){console.log(t),e.isActive&&e.setState({isLoading:!1})}))}},{key:"componentWillUnmount",value:function(){this.isActive=!1}},{key:"render",value:function(){return o.a.createElement(o.a.Fragment,null,(this.state.creating||this.state.selectedEvent)&&o.a.createElement(C,null),this.state.creating&&o.a.createElement(y,{title:"Add Event",canCancel:!0,canConfirm:!0,onCancel:this.modalCancelHandler,onConfirm:this.modalConfirmHandler,confirmText:"Confirm"},o.a.createElement("form",null,o.a.createElement("div",{className:"form-control"},o.a.createElement("label",{htmlFor:"title"},"Title"),o.a.createElement("input",{type:"text",id:"title",ref:this.titleElRef})),o.a.createElement("div",{className:"form-control"},o.a.createElement("label",{htmlFor:"price"},"Price"),o.a.createElement("input",{type:"number",id:"price",ref:this.priceElRef})),o.a.createElement("div",{className:"form-control"},o.a.createElement("label",{htmlFor:"date"},"Date"),o.a.createElement("input",{type:"datetime-local",id:"date",ref:this.dateElRef})),o.a.createElement("div",{className:"form-control"},o.a.createElement("label",{htmlFor:"description"},"Description"),o.a.createElement("textarea",{id:"description",rows:"4",ref:this.descriptionElRef})))),this.state.selectedEvent&&o.a.createElement(y,{title:this.state.selectedEvent.title,canCancel:!0,canConfirm:!0,onCancel:this.modalCancelHandler,onConfirm:this.bookEventHandler,confirmText:this.context.token?"Book":"Confirm"},o.a.createElement("h1",null,this.state.selectedEvent.title),o.a.createElement("h2",null,"$",this.state.selectedEvent.price," - ",new Date(this.state.selectedEvent.date).toLocaleDateString()),o.a.createElement("p",null,this.state.selectedEvent.description)),this.context.token&&o.a.createElement("div",{className:"events-control"},o.a.createElement("p",null,"Share your own Events!"),o.a.createElement("button",{className:"btn",onClick:this.startCreateEventHandler},"Create Event")),this.state.isLoading?o.a.createElement(v,{className:"loading"}):o.a.createElement(S,{events:this.state.events,authUserId:this.context.userId,onViewDetail:this.showDetailHandler}))}}]),n}(a.Component);w.contextType=h;var _=w,j=(n(36),function(e){return o.a.createElement(h.Consumer,null,(function(e){return o.a.createElement("header",{className:"main-navigation"},o.a.createElement("div",{className:"main-navigation_logo"},o.a.createElement("h1",{className:"main-heading"},"EasyEvent")),o.a.createElement("div",{className:"main-navigation_items"},o.a.createElement("ul",null,!e.token&&o.a.createElement("li",null,o.a.createElement(m.b,{to:"/auth"}," Authenticate")),"  ",o.a.createElement("li",null,o.a.createElement(m.b,{to:"/events"},"Events")),e.token&&o.a.createElement(o.a.Fragment,null,o.a.createElement("li",null,o.a.createElement(m.b,{to:"/bookings"}," Bookings")),o.a.createElement("li",null,o.a.createElement("button",{onClick:e.logout},"Logout"))))))}))}),O=(n(42),function(e){Object(s.a)(n,e);var t=Object(u.a)(n);function n(){var e;Object(l.a)(this,n);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return(e=t.call.apply(t,[this].concat(o))).state={token:null,userId:null},e.login=function(t,n,a){e.setState({token:t,userId:n})},e.logout=function(){e.setState({token:null,userId:null})},e}return Object(c.a)(n,[{key:"render",value:function(){return o.a.createElement(m.a,null,o.a.createElement(o.a.Fragment,null,o.a.createElement(h.Provider,{value:{token:this.state.token,userId:this.state.userId,login:this.login,logout:this.logout}},o.a.createElement(j,null),o.a.createElement("main",{className:"main-content"},o.a.createElement(d.d,null,this.state.token&&o.a.createElement(d.a,{from:"/",to:"/events",exact:!0}),this.state.token&&o.a.createElement(d.a,{from:"/auth",to:"/events",exact:!0}),!this.state.token&&o.a.createElement(d.b,{path:"/auth",component:E}),o.a.createElement(d.b,{path:"/events",component:_}),"     // event page doesnot require authentication",this.state.token&&o.a.createElement(d.b,{path:"/bookings",component:b}),!this.state.token&&o.a.createElement(d.a,{to:"/auth",exact:!0}))))))}}]),n}(a.Component));r.a.render(o.a.createElement(o.a.StrictMode,null,o.a.createElement(O,null)),document.getElementById("root"))}},[[22,1,2]]]);
//# sourceMappingURL=main.66fc8978.chunk.js.map